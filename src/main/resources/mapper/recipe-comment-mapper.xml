<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="recipeComment">

    <!-- 댓글 생성 -->
    <insert id="save" parameterType="com.example.demo.TEST_001.dto.RecipeCommentDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO recipe_comment (
            recipe_id,
            user_id,
            content
        )
        VALUES (
            #{recipeId},
            #{userId},
            #{content}
        )
    </insert>

    <!-- 댓글 조회 (ID로) -->
    <select id="findById" parameterType="long" resultType="com.example.demo.TEST_001.dto.RecipeCommentDTO">
        SELECT
            rc.id,
            rc.recipe_id,
            rc.user_id,
            rc.content,
            rc.created_at,
            rc.updated_at,
            u.name AS authorName,
            u.username AS authorUsername
        FROM recipe_comment rc
        JOIN users u ON rc.user_id = u.id
        WHERE rc.id = #{id}
    </select>

    <!-- 레시피별 댓글 목록 조회 -->
    <select id="findByRecipeId" parameterType="long" resultType="com.example.demo.TEST_001.dto.RecipeCommentDTO">
        SELECT
            rc.id,
            rc.recipe_id,
            rc.user_id,
            rc.content,
            rc.created_at,
            rc.updated_at,
            u.name AS authorName,
            u.username AS authorUsername
        FROM recipe_comment rc
        JOIN users u ON rc.user_id = u.id
        WHERE rc.recipe_id = #{recipeId}
        ORDER BY rc.created_at DESC
    </select>

    <!-- 댓글 수정 -->
    <update id="update" parameterType="com.example.demo.TEST_001.dto.RecipeCommentDTO">
        UPDATE recipe_comment
        SET content = #{content}
        WHERE id = #{id}
    </update>

    <!-- 댓글 삭제 -->
    <delete id="deleteById" parameterType="long">
        DELETE FROM recipe_comment
        WHERE id = #{id}
    </delete>

    <!-- 레시피별 댓글 수 조회 -->
    <select id="countByRecipeId" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM recipe_comment
        WHERE recipe_id = #{recipeId}
    </select>

</mapper>
